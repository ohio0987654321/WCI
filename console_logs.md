# Checking Console Logs for WindowControlInjector Issues

This document provides instructions for checking macOS Console logs to debug issues with the WindowControlInjector dylib.

## Instructions for Using Console.app

1. **Open Console.app**:
   - Navigate to Applications > Utilities > Console.app
   - Or use Spotlight (Cmd+Space) and search for "Console"

2. **Set Up Filters for WindowControlInjector**:
   - In the search bar near the top of the window, enter the following search terms one by one:

   ```
   dyld
   DYLD_INSERT_LIBRARIES
   WindowControlInjector
   libwindow_control
   WCI
   ```

   - Check both system and user log levels to ensure you catch all relevant messages

3. **Look for SIP-Related Issues**:
   - Search for `Security` and `SIP` to find System Integrity Protection messages
   - Common messages indicating SIP issues:
     * "DYLD_INSERT_LIBRARIES ignored"
     * "Environment variable redefined"
     * "Security policy would not allow process"

4. **Check for Library Loading Issues**:
   - Look for messages containing:
     * "dyld: Library not loaded"
     * "image not found"
     * "Symbol not found"

5. **Filter by Target Application**:
   - Enter the name of the application you're trying to inject into
   - This will show logs specific to that application during launch

6. **Check for Crash Reports**:
   - Click on "Crash Reports" in the sidebar
   - Sort by date and look for crashes of the target application around the time of your injection attempts

## Understanding the Log Files Created by WindowControlInjector

The following log files are generated by our debugging modifications:

1. **`~/wci_debug.log`** - Created by the dylib itself when loaded
   - If this file exists and contains content, the dylib was successfully loaded
   - Check this file for initialization errors
   - Look for specific profile loading issues

2. **`~/wci_launch.log`** - Created by the direct_launch.sh script
   - Contains stdout/stderr from the direct application launch
   - Includes DYLD_PRINT_LIBRARIES output which shows all loaded libraries

## Common Issues and Their Log Signatures

### 1. SIP Blocking Environment Variables
```
Ignoring DYLD_INSERT_LIBRARIES=/path/to/libwindow_control.dylib for system binary
```

### 2. Dylib Not Found
```
dyld: Library not loaded: /path/to/libwindow_control.dylib
  Referenced from: /Applications/YourApp.app/Contents/MacOS/YourApp
  Reason: image not found
```

### 3. Symbol Resolution Issues
```
dyld: Symbol not found: _WCInitialize
  Referenced from: /Applications/YourApp.app/Contents/MacOS/YourApp
  Expected in: /path/to/libwindow_control.dylib
```

### 4. Permissions Issues
```
Could not access library: /path/to/libwindow_control.dylib (Permission denied)
```

## Troubleshooting Steps Based on Log Messages

1. **If no wci_debug.log is created**:
   - The dylib is not being loaded at all
   - Check permissions on the dylib file
   - Try running the app with direct_launch.sh instead of the normal injector
   - Verify SIP is not blocking DYLD_INSERT_LIBRARIES

2. **If wci_debug.log exists but no interception occurs**:
   - The dylib is loaded but not working properly
   - Check the log for initialization errors
   - Verify the interceptor installation was successful
   - Look for specific error messages in the initialization sequence

3. **If Console shows SIP-related messages**:
   - Consider temporarily disabling SIP for testing (requires reboot)
   - Or target only non-system applications
   - Try a different injection mechanism that works with SIP enabled

4. **If Console shows crash reports**:
   - Check the crash logs for specific reasons
   - Look for stack traces mentioning libwindow_control.dylib
   - Check for compatibility issues with the target application
